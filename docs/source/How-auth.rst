Как авторизоваться в системе Диадок
===================================

Для работы с системой Диадок необходимо:
    - загрузить внешнюю компоненту
    - создать соединение с сервером Диадок
    - создать контекст работы с организацией


Как загрузить внешнюю компоненту
--------------------------------

-  Загрузка AddIn компоненты

::

    //Загрузка внешней компоненты
    ИмяФайла = "C:\Temp\AddInDiadocAPI.dll";
    ЗагрузитьВнешнююКомпоненту(ИмяФайла);

    //Создание объекта DiadocInvoiceAPI
    DiadocApi_ = Новый("AddIn.DiadocInvoiceAPI");
    DiadocApi  = DiadocApi_.CreateObject();

    //Задаем параметры подлючения к серверу
    DiadocApi.ApiClientId = КлючРазработчика;
    DiadocApi.ServerUrl   = "https://diadoc-api.kontur.ru:443";


-  Загрузка COM компоненты

    В случае, когда режим запуска 1С не позволяет запуск внешних компонент, использующих технологию COM, (например, на стороне сервера 1С 8.2), необходимо использовать сборку компоненты, которая реализована в виде классического COM-объекта.
    В этом случае перед использованием компоненты нужно зарегистрировать файл DiadocComApi.dll с помощью команды `regsvr32 <https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regsvr32>`_


    В случае запуска компоненты 64-битным приложением, необходимо использовать 64-битную сборку данной компоненты

    После этого загрузка и инициализация компоненты производится следующим образом:

::

    //создаем корневой элемент COM-объекта
    DiadocApi = Новый ComОбъект("Diadoc.DiadocClient");

    //Задаем параметры подлючения к серверу
    DiadocApi.ApiClientId = КлючРазработчика;
    DiadocApi.ServerUrl   = "https://diadoc-api.kontur.ru:443";

**Ключ разработчика** представляет собой последовательность символов, идентифицирующий разработчика интеграционного решения.
Для того чтобы получить ключ разработчика, необходимо оставить заявку на `сайте <https://www.diadoc.ru/integrations/api#order-form-integration>`_


Как создать соединение и авторизоваться
---------------------------------------

Для авторизации и последующих вызовов методов сервера Диадок необходимо создать :doc:`Объект соединения <Connection>`. Соединение следует создавать на каждый сеанс работы.
Явно освобождать ресурсы после окончания работы с этим объектом не нужно.

::

    //Получение списка сертификатов
    Certificates = DiadocApi.GetPersonalCertificates();

    //Создание соединения
    ОтпечатокСертификата = Certificates.GetItem(0).Thumbprint;
    DiadocConnection = DiadocApi.CreateConnectionByCertificate(ОтпечатокСертификата);


Создать контекст работы с организацией
--------------------------------------

Все действия с документами: отправка, получение, подписание и т.д. - выполняются в контексте организации, к которой пользователь имеет права доступа в системе Диадок.
Для работы с контекстом организации предназначен :doc:`Organization <Organization>`.
Получить объект :doc:`Organization <Organization>` можно одним из двух способов:

-  Получение :doc:`Organization <Organization>` по идентификатору.

::

    BoxId = "8fd0af8abe934c7091b5ccd476ef1cb5@diadoc.ru";
    Organization = DiadocConnection.GetOrganizationById(BoxId);

-  Получение :doc:`коллекции <Collection>` всех доступных пользователю :doc:`Organization <Organization>`.

::

    OrganizationList = DiadocConnection.GetOrganizationList();
    Ц = 0;
    Пока Ц < OrganizationList.Count() Цикл
        Organization = OrganizationList.GetItem(ц);
        Сообщить(Organization.Name);
        Ц = Ц + 1;
    КонецЦикла;